!function(){"use strict";class t{x=0;y=0;constructor(t,i){null==t?(this.x=0,this.y=0):"object"==typeof t?2==t.length?(this.x=t[0],this.y=t[1]):(this.x=t.x,this.y=t.y):null==i?(this.x=t,this.y=t):(this.x=t,this.y=i)}set(t,i){return this.x=t,this.y=i,this}toArray(){return[this.x,this.y]}}function i(...i){return new t(...i)}class e{constructor(t,i,s){null==t?(this.x=0,this.y=0,this.z=0):"object"==typeof t?3==t.length?(this.x=t[0],this.y=t[1],this.z=t[2]):(this.x=t.x,this.y=t.y,this.z=t.z):null==i&&null==s?(this.x=t,this.y=t,this.z=t):(this.x=t,this.y=i,this.z=s)}set(t,i,s){return this.x=t,this.y=i,this.z=s,this}dot(t){return this.x*t.x+this.y*t.y+this.z*t.z}cross(t){return h(this.y*t.z-this.z*t.y,this.z*t.x-this.x*t.z,this.x*t.y-this.y*t.x)}add(t){return"number"==typeof t?h(this.x+t,this.y+t,this.z+t):h(this.x+t.x,this.y+t.y,this.z+t.z)}sub(t){return"number"==typeof t?h(this.x-t,this.y-t,this.z-t):h(this.x-t.x,this.y-t.y,this.z-t.z)}mul(t){return"number"==typeof t?h(this.x*t,this.y*t,this.z*t):h(this.x*t.x,this.y*t.y,this.z*t.z)}div(t){return"number"==typeof t?h(this.x/t,this.y/t,this.z/t):h(this.x/t.x,this.y/t.y,this.z/t.z)}neg(){return h(-this.x,-this.y,-this.z)}len2(){return this.x*this.x+this.y*this.y+this.z*this.z}len(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return 0!=t&&1!=t?Math.sqrt(t):t}normalize(){let t=this.x*this.x+this.y*this.y+this.z*this.z;return 0!=t&&1!=t?(t=Math.sqrt(t),h(this.x/t,this.y/t,this.z/t)):h(this)}min(t){return"number"==typeof t?h(Math.min(this.x,t),Math.min(this.y,t),Math.min(this.z,t)):h(Math.min(this.x,t.x),Math.min(this.y,t.y),Math.min(this.z,t.z))}max(t){return"number"==typeof t?h(Math.max(this.x,t),Math.max(this.y,t),Math.max(this.z,t)):h(Math.max(this.x,t.x),Math.max(this.y,t.y),Math.max(this.z,t.z))}toArray(){return[this.x,this.y,this.z]}}function h(...t){return new e(...t)}class r{addMethod(t,i,s){var e=t[i];t[i]=(...i)=>s.length==i.length?s.apply(t,i):"function"==typeof e?e.apply(t,i):void 0}constructor(t=null){null==t?this.m=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]:"object"==typeof t&&4==t.length?this.m=t:this.m=t.m,this.addMethod(this,"setTranslate",((t,i,s)=>(this.m=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[t,i,s,1]],this))),this.addMethod(this,"setTranslate",(t=>this.setTranslate(t.x,t.y,t.z))),this.addMethod(this,"translate",((t,i,s)=>(this.mul([[1,0,0,0],[0,1,0,0],[0,0,1,0],[t,i,s,1]]),this))),this.addMethod(this,"translate",(t=>this.translate(t.x,t.y,t.z))),this.addMethod(this,"setScale",((t,i,s)=>(this.m=[[t,0,0,0],[0,i,0,0],[0,0,s,0],[0,0,0,1]],this))),this.addMethod(this,"setScale",(t=>"object"==typeof t?this.setScale(t.x,t.y,t.z):this.setScale(t,t,t))),this.addMethod(this,"scale",((t,i,s)=>(this.mul([[t,0,0,0],[0,i,0,0],[0,0,s,0],[0,0,0,1]]),this))),this.addMethod(this,"scale",(t=>"object"==typeof t?this.scale(t.x,t.y,t.z):this.scale(t,t,t)))}setRotate(t,i){let s=t*Math.PI/180,e=Math.sin(s),h=Math.cos(s),r=0,m=0,a=1;"object"==typeof i&&(3==i.length?(r=i[0],m=i[1],a=i[2]):(r=i.x,m=i.y,a=i.z));let n=r*r+m*m+a*a;return 0!=n&&1!=n&&(n=Math.sqrt(n),r/=n,m/=n,a/=n),this.m[0][0]=h+r*r*(1-h),this.m[0][1]=r*m*(1-h)+a*e,this.m[0][2]=r*a*(1-h)-m*e,this.m[0][3]=0,this.m[1][0]=m*r*(1-h)-a*e,this.m[1][1]=h+m*m*(1-h),this.m[1][2]=m*a*(1-h)+r*e,this.m[1][3]=0,this.m[2][0]=a*r*(1-h)+m*e,this.m[2][1]=a*m*(1-h)-r*e,this.m[2][2]=h+a*a*(1-h),this.m[2][3]=0,this.m[3][0]=0,this.m[3][1]=0,this.m[3][2]=0,this.m[3][3]=1,this}rotate(t,i){return this.mul(m().setRotate(t,i))}transpose(){let t=[[],[],[],[]];for(let i=0;i<4;i++)for(let s=0;s<4;s++)t[i][s]=this.m[s][i];return m(t)}mul(t){let i;return i=4==t.length?t:t.m,this.m=[[this.m[0][0]*i[0][0]+this.m[0][1]*i[1][0]+this.m[0][2]*i[2][0]+this.m[0][3]*i[3][0],this.m[0][0]*i[0][1]+this.m[0][1]*i[1][1]+this.m[0][2]*i[2][1]+this.m[0][3]*i[3][1],this.m[0][0]*i[0][2]+this.m[0][1]*i[1][2]+this.m[0][2]*i[2][2]+this.m[0][3]*i[3][2],this.m[0][0]*i[0][3]+this.m[0][1]*i[1][3]+this.m[0][2]*i[2][3]+this.m[0][3]*i[3][3]],[this.m[1][0]*i[0][0]+this.m[1][1]*i[1][0]+this.m[1][2]*i[2][0]+this.m[1][3]*i[3][0],this.m[1][0]*i[0][1]+this.m[1][1]*i[1][1]+this.m[1][2]*i[2][1]+this.m[1][3]*i[3][1],this.m[1][0]*i[0][2]+this.m[1][1]*i[1][2]+this.m[1][2]*i[2][2]+this.m[1][3]*i[3][2],this.m[1][0]*i[0][3]+this.m[1][1]*i[1][3]+this.m[1][2]*i[2][3]+this.m[1][3]*i[3][3]],[this.m[2][0]*i[0][0]+this.m[2][1]*i[1][0]+this.m[2][2]*i[2][0]+this.m[2][3]*i[3][0],this.m[2][0]*i[0][1]+this.m[2][1]*i[1][1]+this.m[2][2]*i[2][1]+this.m[2][3]*i[3][1],this.m[2][0]*i[0][2]+this.m[2][1]*i[1][2]+this.m[2][2]*i[2][2]+this.m[2][3]*i[3][2],this.m[2][0]*i[0][3]+this.m[2][1]*i[1][3]+this.m[2][2]*i[2][3]+this.m[2][3]*i[3][3]],[this.m[3][0]*i[0][0]+this.m[3][1]*i[1][0]+this.m[3][2]*i[2][0]+this.m[3][3]*i[3][0],this.m[3][0]*i[0][1]+this.m[3][1]*i[1][1]+this.m[3][2]*i[2][1]+this.m[3][3]*i[3][1],this.m[3][0]*i[0][2]+this.m[3][1]*i[1][2]+this.m[3][2]*i[2][2]+this.m[3][3]*i[3][2],this.m[3][0]*i[0][3]+this.m[3][1]*i[1][3]+this.m[3][2]*i[2][3]+this.m[3][3]*i[3][3]]],this}determ3x3(t,i,s,e,h,r,m,a,n){return t*h*n-t*r*a-i*e*n+i*r*m+s*e*a-s*h*m}determ(){return this.m[0][0]*this.determ3x3(this.m[1][1],this.m[1][2],this.m[1][3],this.m[2][1],this.m[2][2],this.m[2][3],this.m[3][1],this.m[3][2],this.m[3][3])-this.m[0][1]*this.determ3x3(this.m[1][0],this.m[1][2],this.m[1][3],this.m[2][0],this.m[2][2],this.m[2][3],this.m[3][0],this.m[3][2],this.m[3][3])+this.m[0][2]*this.determ3x3(this.m[1][0],this.m[1][1],this.m[1][3],this.m[2][0],this.m[2][1],this.m[2][3],this.m[3][0],this.m[3][1],this.m[3][3])-this.m[0][3]*this.determ3x3(this.m[1][0],this.m[1][1],this.m[1][2],this.m[2][0],this.m[2][1],this.m[2][2],this.m[3][0],this.m[3][1],this.m[3][2])}inverse(){let t=[[],[],[],[]],i=this.determ();if(0==i){return m([[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]])}return t[0][0]=this.determ3x3(this.m[1][1],this.m[1][2],this.m[1][3],this.m[2][1],this.m[2][2],this.m[2][3],this.m[3][1],this.m[3][2],this.m[3][3])/i,t[1][0]=-this.determ3x3(this.m[1][0],this.m[1][2],this.m[1][3],this.m[2][0],this.m[2][2],this.m[2][3],this.m[3][0],this.m[3][2],this.m[3][3])/i,t[2][0]=this.determ3x3(this.m[1][0],this.m[1][1],this.m[1][3],this.m[2][0],this.m[2][1],this.m[2][3],this.m[3][0],this.m[3][1],this.m[3][3])/i,t[3][0]=-this.determ3x3(this.m[1][0],this.m[1][1],this.m[1][2],this.m[2][0],this.m[2][1],this.m[2][2],this.m[3][0],this.m[3][1],this.m[3][2])/i,t[0][1]=-this.determ3x3(this.m[0][1],this.m[0][2],this.m[0][3],this.m[2][1],this.m[2][2],this.m[2][3],this.m[3][1],this.m[3][2],this.m[3][3])/i,t[1][1]=this.determ3x3(this.m[0][0],this.m[0][2],this.m[0][3],this.m[2][0],this.m[2][2],this.m[2][3],this.m[3][0],this.m[3][2],this.m[3][3])/i,t[2][1]=-this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][3],this.m[2][0],this.m[2][1],this.m[2][3],this.m[3][0],this.m[3][1],this.m[3][3])/i,t[3][1]=this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][2],this.m[2][0],this.m[2][1],this.m[2][2],this.m[3][0],this.m[3][1],this.m[3][2])/i,t[0][2]=this.determ3x3(this.m[0][1],this.m[0][2],this.m[0][3],this.m[1][1],this.m[1][2],this.m[1][3],this.m[3][1],this.m[3][2],this.m[3][3])/i,t[1][2]=-this.determ3x3(this.m[0][0],this.m[0][2],this.m[0][3],this.m[1][0],this.m[1][2],this.m[1][3],this.m[3][0],this.m[3][2],this.m[3][3])/i,t[2][2]=this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][3],this.m[1][0],this.m[1][1],this.m[1][3],this.m[3][0],this.m[3][1],this.m[3][3])/i,t[3][2]=-this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][2],this.m[1][0],this.m[1][1],this.m[1][2],this.m[3][0],this.m[3][1],this.m[3][2])/i,t[0][3]=-this.determ3x3(this.m[0][1],this.m[0][2],this.m[0][3],this.m[1][1],this.m[1][2],this.m[1][3],this.m[2][1],this.m[2][2],this.m[2][3])/i,t[1][3]=this.determ3x3(this.m[0][0],this.m[0][2],this.m[0][3],this.m[1][0],this.m[1][2],this.m[1][3],this.m[2][0],this.m[2][2],this.m[2][3])/i,t[2][3]=-this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][3],this.m[1][0],this.m[1][1],this.m[1][3],this.m[2][0],this.m[2][1],this.m[2][3])/i,t[3][3]=this.determ3x3(this.m[0][0],this.m[0][1],this.m[0][2],this.m[1][0],this.m[1][1],this.m[1][2],this.m[2][0],this.m[2][1],this.m[2][2])/i,this.m=t,this}setIdentity(){return this.m=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]],this}setView(t,i,s){let e=i.sub(t).normalize(),h=e.cross(s).normalize(),r=h.cross(e).normalize();return this.m=[[h.x,r.x,-e.x,0],[h.y,r.y,-e.y,0],[h.z,r.z,-e.z,0],[-t.dot(h),-t.dot(r),t.dot(e),1]],this}setOrtho(t,i,s,e,h,r){return this.m=[[2/(i-t),0,0,0],[0,2/(e-s),0,0],[0,0,-2/(r-h),0],[-(i+t)/(i-t),-(e+s)/(e-s),-(r+h)/(r-h),1]],this}setFrustum(t,i,s,e,h,r){return this.m=[[2*h/(i-t),0,0,0],[0,2*h/(e-s),0,0],[(i+t)/(i-t),(e+s)/(e-s),-(r+h)/(r-h),-1],[0,0,-2*h*r/(r-h),0]],this}view(t,i,s){return this.mul(m().setView(t,i,s))}ortho(t,i,s,e,h,r){return this.mul(m().setOrtho(t,i,s,e,h,r))}frustum(t,i,s,e,h,r){return this.mul(m().setFrustum(t,i,s,e,h,r))}transform(t){let i=t.x*this.m[0][3]+t.y*this.m[1][3]+t.z*this.m[2][3]+this.m[3][3];return h((t.x*this.m[0][0]+t.y*this.m[1][0]+t.z*this.m[2][0]+this.m[3][0])/i,(t.x*this.m[0][1]+t.y*this.m[1][1]+t.z*this.m[2][1]+this.m[3][1])/i,(t.x*this.m[0][2]+t.y*this.m[1][2]+t.z*this.m[2][2]+this.m[3][2])/i)}transformVector(t){return h(t.x*this.m[0][0]+t.y*this.m[1][0]+t.z*this.m[2][0],t.x*this.m[0][1]+t.y*this.m[1][1]+t.z*this.m[2][1],t.x*this.m[0][2]+t.y*this.m[1][2]+t.z*this.m[2][2])}transformPoint(t){return h(t.x*this.m[0][0]+t.y*this.m[1][0]+t.z*this.m[2][0]+this.m[3][0],t.x*this.m[0][1]+t.y*this.m[1][1]+t.z*this.m[2][1]+this.m[3][1],t.x*this.m[0][2]+t.y*this.m[1][2]+t.z*this.m[2][2]+this.m[3][2])}toArray(){return[].concat(...this.m)}}function m(...t){return new r(...t)}class a{projSize=.1;projDist=.1;projFarClip=1800;frameW=30;frameH=30;matrView=m();matrProj=m();matrVP=m();loc=h();at=h();dir=h();up=h();right=h();constructor(){this.setDef()}set(t,i,s){this.matrView.setView(t,i,s),this.loc=h(t),this.at=h(i),this.dir.set(-this.matrView.m[0][2],-this.matrView.m[1][2],-this.matrView.m[2][2]),this.up.set(this.matrView.m[0][1],this.matrView.m[1][1],this.matrView.m[2][1]),this.right.set(this.matrView.m[0][0],this.matrView.m[1][0],this.matrView.m[2][0]),this.matrVP=m(this.matrView).mul(this.matrProj)}setProj(t,i,s){let e=t,h=t;this.projDist=i,this.projSize=t,this.projFarClip=s,this.frameW>this.frameH?e*=this.frameW/this.frameH:h*=this.frameH/this.frameW,this.matrProj.setFrustum(-e/2,e/2,-h/2,h/2,i,s),this.matrVP=m(this.matrView).mul(this.matrProj)}setSize(t,i){t<1&&(t=1),i<1&&(i=1),this.frameW=t,this.frameH=i,this.setProj(this.projSize,this.projDist,this.projFarClip)}setDef(){this.loc.set(0,0,8),this.at.set(0,0,0),this.dir.set(0,0,-1),this.up.set(0,1,0),this.right.set(1,0,0),this.projDist=.1,this.projSize=.1,this.projFarClip=1800,this.frameW=30,this.frameH=30,this.set(this.loc,this.at,this.up),this.setProj(this.projSize,this.projDist,this.projFarClip),this.setSize(this.frameW,this.frameH)}}function n(...t){return new a(t)}function l(t){let i=[];const s=t=>{if("object"==typeof t)if(null!=t.toArray)i=i.concat(t.toArray());else if(Array.isArray(t))for(let i=0;i<t.length;i++)s(t[i]);else for(let i in t)s(t[i]);else"boolean"==typeof t?i.push(Number(t)):"number"==typeof t&&i.push(t)};return s(t),i}class o{constructor(t,i,s){let e,h;this.rnd=t,this.type=i,"number"==typeof s?(h=s,e=null):s instanceof Float32Array||s instanceof Uint32Array?(e=s,h=4*e.length):(e=l(s),h=4*e.length),this.size=h,this.id=null,0!=h&&null!=i&&(this.id=t.gl.createBuffer(),t.gl.bindBuffer(i,this.id),t.gl.bufferData(i,h,t.gl.STATIC_DRAW),null!=e&&(e instanceof Float32Array||e instanceof Uint32Array?(this.rnd.gl.bindBuffer(this.type,this.id),this.rnd.gl.bufferSubData(this.type,0,e,0)):(this.rnd.gl.bindBuffer(this.type,this.id),this.rnd.gl.bufferSubData(this.type,0,new Float32Array(e),0))))}update(t){null!=this.id&&(t instanceof Float32Array||t instanceof Uint32Array?(this.rnd.gl.bindBuffer(this.type,this.id),this.rnd.gl.bufferSubData(this.type,0,t,0)):(this.rnd.gl.bindBuffer(this.type,this.id),this.rnd.gl.bufferSubData(this.type,0,new Float32Array(l(t)),0)))}}class d extends o{constructor(t,i,s,e){super(t,t.gl.UNIFORM_BUFFER,s),this.name=i,this.bindPoint=e}apply(t){null!=t&&null!=t.id&&null!=t.id&&null!=t.uniformBlocks[this.name]&&(this.rnd.gl.uniformBlockBinding(t.id,t.uniformBlocks[this.name].index,this.bindPoint),this.rnd.gl.bindBufferBase(this.rnd.gl.UNIFORM_BUFFER,this.bindPoint,this.id))}}function u(...t){return new d(...t)}class c extends o{constructor(t,i,s){let e=0;"number"==typeof s?e=s:"object"==typeof s&&(e=s.length),super(t,t.gl.ARRAY_BUFFER,e*i),"object"==typeof s&&this.update(s)}apply(){null!=this.id&&this.rnd.gl.bindBuffer(this.rnd.gl.ARRAY_BUFFER,this.id)}}function f(...t){return new c(...t)}class g extends o{constructor(t,i){let s=0;"number"==typeof i?s=i:"object"==typeof i&&(s=i.length),super(t,t.gl.ELEMENT_ARRAY_BUFFER,4*s),"object"==typeof i&&(t.gl.bindBuffer(t.gl.ELEMENT_ARRAY_BUFFER,this.id),t.gl.bufferSubData(this.type,0,new Uint32Array(i),0))}apply(){this.rnd.gl.bindBuffer(this.rnd.gl.ELEMENT_ARRAY_BUFFER,this.id)}}function p(...t){return new g(...t)}class y{async _init(t){this.name=t,vg.log("Shader load: "+this.name),this.id=null,this.attrs={},this.uniforms={},this.uniformBlocks={},this.shaders=[{id:null,type:this.rnd.gl.VERTEX_SHADER,name:"vert",src:""},{id:null,type:this.rnd.gl.FRAGMENT_SHADER,name:"frag",src:""}];for(const i of this.shaders){let s=await fetch(`bin/shaders/${t}/${i.name}.glsl?30472908${Math.random()}`),e=await s.text();"string"==typeof e&&""!=e&&(i.src=e)}this.updateShaderSource()}updateShaderSource(){let t=vg.log(`Shader ${this.name} update`);if(this.shaders[0].id=null,this.shaders[1].id=null,this.id=null,""!=this.shaders[0].src&&""!=this.shaders[1].src){if(this.shaders.forEach((i=>{if(i.id=this.rnd.gl.createShader(i.type),this.rnd.gl.shaderSource(i.id,i.src),this.rnd.gl.compileShader(i.id),!this.rnd.gl.getShaderParameter(i.id,this.rnd.gl.COMPILE_STATUS)){let s=this.rnd.gl.getShaderInfoLog(i.id);vg.logAdd(` [${i.name}] fail:\n${s}`,t),console.log(` [${i.name}] fail:\n${s}`)}})),this.id=this.rnd.gl.createProgram(),this.shaders.forEach((t=>{null!=t.id&&this.rnd.gl.attachShader(this.id,t.id)})),this.rnd.gl.linkProgram(this.id),!this.rnd.gl.getProgramParameter(this.id,this.rnd.gl.LINK_STATUS)){const t=this.rnd.gl.getProgramInfoLog(this.id);vg.logAdd(` [prog] fail:\n${t}`),console.log(` [${s.name}] fail:\n${t}`)}this.updateShaderData()}}updateShaderData(){this.attrs={};let t=this.rnd.gl.getProgramParameter(this.id,this.rnd.gl.ACTIVE_ATTRIBUTES);for(let i=0;i<t;i++){const t=this.rnd.gl.getActiveAttrib(this.id,i);this.attrs[t.name]={name:t.name,type:t.type,size:t.size,loc:this.rnd.gl.getAttribLocation(this.id,t.name)}}this.uniforms={};let i=this.rnd.gl.getProgramParameter(this.id,this.rnd.gl.ACTIVE_UNIFORMS);for(let t=0;t<i;t++){const i=this.rnd.gl.getActiveUniform(this.id,t);this.uniforms[i.name]={name:i.name,type:i.type,size:i.size,loc:this.rnd.gl.getUniformLocation(this.id,i.name)}}this.uniformBlocks={};let s=this.rnd.gl.getProgramParameter(this.id,this.rnd.gl.ACTIVE_UNIFORM_BLOCKS);for(let t=0;t<s;t++){const i=this.rnd.gl.getActiveUniformBlockName(this.id,t),s=this.rnd.gl.getUniformBlockIndex(this.id,i);this.uniformBlocks[i]={name:i,index:s,size:this.rnd.gl.getActiveUniformBlockParameter(this.id,s,this.rnd.gl.UNIFORM_BLOCK_DATA_SIZE),bind:this.rnd.gl.getActiveUniformBlockParameter(this.id,s,this.rnd.gl.UNIFORM_BLOCK_BINDING)}}}constructor(t,i){this.rnd=t,this._init(i)}apply(){null!=this.id&&this.rnd.gl.useProgram(this.id)}}function x(t,i){return new y(t,i)}class v{constructor(...t){if(t[0]instanceof v){Object.assign(this,t[0]);let i=t[1];this.textures=[];for(let t in i){let s=i[t];t=Number(t),this.textures[t]=texture(s),t>=0&&t<=3&&(this.mtlData.textureFlags[t]=1)}return}let i=t[1],s=t[2];this.name=t[0],this.shader=null,this.mtlData={ambient:[.1,.1,.1,0],diffuse:[.8,.8,.8,1],specular:[.5,.5,.5,47],textureFlags:[0,0,0,0]},i&&(i.ka&&(this.mtlData.ambient=i.ka.toArray().concat([0])),i.kd&&(i.trans?this.mtlData.diffuse=i.kd.toArray().concat([i.trans]):this.mtlData.diffuse=i.kd.toArray().concat([1])),i.ks&&i.ph&&(this.mtlData.specular=i.ks.toArray().concat([i.ph]))),this.textures=[];for(let t in s){let i=s[t];t=Number(t),this.textures[t]=texture(i),t>=0&&t<=3&&(this.mtlData.textureFlags[t]=1)}}setShd(t){return this.shader=t,this}apply(t){null==this.mtlBuf&&(this.mtlBuf=u(t,"mtlBuffer",64,5),this.mtlBuf.update(this.mtlData)),null==this.shader&&(this.shader=t.shaders.default),null!=this.shader.id&&(this.shader.apply(),this.mtlBuf.apply(this.shader))}}function b(...t){return new v(...t)}b.materialLibInit=t=>{t.materialLib={Default:b("Default",{ka:h(.2,.2,.2),kd:h(.8,.8,.8),ks:h(.5,.5,.5),ph:102}),BlackPlastic:b("Black Plastic",{ka:h(0,0,0),kd:h(.01,.01,.01),ks:h(.5,.5,.5),ph:32}),Brass:b("Brass",{ka:h(.329412,.223529,.027451),kd:h(.780392,.568627,.113725),ks:h(.992157,.941176,.807843),ph:27.8974}),Bronze:b("Bronze",{ka:h(.2125,.1275,.054),kd:h(.714,.4284,.18144),ks:h(.393548,.271906,.166721),ph:25.6}),Chrome:b("Chrome",{ka:h(.25,.25,.25),kd:h(.4,.4,.4),ks:h(.774597,.774597,.774597),ph:76.8}),Copper:b("Copper",{ka:h(.19125,.0735,.0225),kd:h(.7038,.27048,.0828),ks:h(.256777,.137622,.086014),ph:12.8}),Gold:b("Gold",{ka:h(.24725,.1995,.0745),kd:h(.75164,.60648,.22648),ks:h(.628281,.555802,.366065),ph:51.2}),Peweter:b("Peweter",{ka:h(.10588,.058824,.113725),kd:h(.427451,.470588,.541176),ks:h(.3333,.3333,.521569),ph:9.84615}),Silver:b("Silver",{ka:h(.19225,.19225,.19225),kd:h(.50754,.50754,.50754),ks:h(.508273,.508273,.508273),ph:51.2}),PolishedSilver:b("Polished Silver",{ka:h(.23125,.23125,.23125),kd:h(.2775,.2775,.2775),ks:h(.773911,.773911,.773911),ph:89.6}),Turquoise:b("Turquoise",{ka:h(.1,.18725,.1745),kd:h(.396,.74151,.69102),ks:h(.297254,.30829,.306678),ph:12.8}),Ruby:b("Ruby",{ka:h(.1745,.01175,.01175),kd:h(.61424,.04136,.04136),ks:h(.727811,.626959,.626959),ph:76.8}),PolishedGold:b("Polished Gold",{ka:h(.24725,.2245,.0645),kd:h(.34615,.3143,.0903),ks:h(.797357,.723991,.208006),ph:83.2}),PolishedBronze:b("Polished Bronze",{ka:h(.25,.148,.06475),kd:h(.4,.2368,.1036),ks:h(.774597,.458561,.200621),ph:76.8}),PolishedCopper:b("Polished Copper",{ka:h(.2295,.08825,.0275),kd:h(.5508,.2118,.066),ks:h(.580594,.223257,.0695701),ph:51.2}),Jade:b("Jade",{ka:h(.135,.2225,.1575),kd:h(.135,.2225,.1575),ks:h(.316228,.316228,.316228),ph:12.8}),Obsidian:b("Obsidian",{ka:h(.05375,.05,.06625),kd:h(.18275,.17,.22525),ks:h(.332741,.328634,.346435),ph:38.4}),Pearl:b("Pearl",{ka:h(.25,.20725,.20725),kd:h(1,.829,.829),ks:h(.296648,.296648,.296648),ph:11.264}),Emerald:b("Emerald",{ka:h(.0215,.1745,.0215),kd:h(.07568,.61424,.07568),ks:h(.633,.727811,.633),ph:76.8}),BlackPlastic:b("Black Plastic",{ka:h(0,0,0),kd:h(.01,.01,.01),ks:h(.5,.5,.5),ph:32}),BlackRubber:b("Black Rubber",{ka:h(.02,.02,.02),kd:h(.01,.01,.01),ks:h(.4,.4,.4),ph:10})}};class B{constructor(t,s,e=i(1,1)){this.pos=h(t),this.norm=h(s),this.texCoord=i(e)}}class k{static default_mtl=b({ka:h(.1),kd:h(.8),ks:h(.5),trans:0});mtl;constructor(t,...i){if(this.rnd=t,this.vBuf=f(t,0),this.iBuf=p(t,0),this.va=null,this.numElements=0,this.transform=m(),this.stride=32,this.offsets={InPosition:0,InNormal:12,InTexCoords:24},this.minBB=h(0,0,0),this.maxBB=h(0,0,0),this.mtl=k.default_mtl,1==i.length)"number"==typeof i[0]?this.numElements=i[0]:"object"==typeof i[0]&&i[0].stride?(this.stride=i[0].stride,i[0].vBuf&&(this.vBuf=f(t,this.stride,i[0].vBuf),this.numElements=i[0].vBuf.length),i[0].iBuf&&(this.iBuf=p(t,i[0].iBuf),this.numElements=i[0].iBuf.length),i[0].offsets&&(this.offsets=i[0].offsets)):(this.vBuf=f(t,this.stride,i[0]),this.numElements=i[0].length);else{let[s,e]=i;this.vBuf=f(t,this.stride,s),this.iBuf=p(t,e),this.numElements=e.length}}setMtl(t){return this.mtl=t,this}draw(t=null){this.mtl.apply(this.rnd),null!=this.mtl.shader.id&&(null==this.va&&null!=this.vBuf.id&&(this.vBuf.apply(),this.va=this.rnd.gl.createVertexArray(),this.rnd.gl.bindVertexArray(this.va),[["InPosition",3],["InNormal",3],["InTexCoords",2]].forEach((t=>{this.mtl.shader.attrs[t[0]]&&(this.rnd.gl.vertexAttribPointer(this.mtl.shader.attrs[t[0]].loc,t[1],this.rnd.gl.FLOAT,!1,this.stride,this.offsets[t[0]]),this.rnd.gl.enableVertexAttribArray(this.mtl.shader.attrs[t[0]].loc))}))),this.rnd.frameBuf.apply(this.mtl.shader),this.rnd.primData.MatrW=m(this.transform),t&&this.rnd.primData.MatrW.mul(t),this.rnd.primData.MatrWVP=m(this.rnd.primData.MatrW).mul(this.rnd.cam.matrVP),this.rnd.primData.MatrInvWTrans=m(this.rnd.primData.MatrW).inverse().transpose(),this.rnd.primBuf.update(this.rnd.primData),this.rnd.primBuf.apply(this.mtl.shader),null!=this.va&&this.rnd.gl.bindVertexArray(this.va),null==this.iBuf.id?this.rnd.gl.drawArrays(this.rnd.gl.TRIANGLES,0,this.numElements):(this.iBuf.apply(),this.rnd.gl.drawElements(this.rnd.gl.TRIANGLES,this.numElements,this.rnd.gl.UNSIGNED_INT,0)))}}function z(...t){return new k(...t)}let T=(t,i,s)=>i.sub(t).cross(s.sub(t)).normalize();function P(){const t=()=>{const t=new Date;return t.getMilliseconds()/1e3+t.getSeconds()+60*t.getMinutes()};return this.response=(i=null)=>{let s=t();this.globalTime=s,this.globalDeltaTime=s-this.oldTime,this.isPause?(this.localDeltaTime=0,this.pauseTime+=s-this.oldTime):(this.localDeltaTime=this.globalDeltaTime,this.localTime=s-this.pauseTime-this.startTime),this.frameCounter++,s-this.oldTimeFPS>3&&(this.FPS=this.frameCounter/(s-this.oldTimeFPS),this.oldTimeFPS=s,this.frameCounter=0,null!=i&&(document.getElementById(i).innerHTML=this.getFPS())),this.oldTime=s},this.getFPS=()=>this.FPS.toFixed(3),this.globalTime=this.localTime=t(),this.globalDeltaTime=this.localDeltaTime=0,this.startTime=this.oldTime=this.oldTimeFPS=this.globalTime,this.frameCounter=0,this.isPause=!1,this.FPS=30,this.pauseTime=0,this}z.addPrimitives=t=>{t.primCreateTetrahedron=()=>{let i=Math.sqrt(2),s=Math.sqrt(3),e=i*s/2,r=h(-i*s/6,0,-i/2),m=h(-i*s/6,0,i/2),a=h(i*s/3,0,0),n=h(0,e,0),l=T(r,a,n).neg(),o=T(a,m,n).neg(),d=T(m,r,n).neg(),u=T(r,m,a).neg();return t.primCreate([vg.vertex(r,l),vg.vertex(a,l),vg.vertex(n,l),vg.vertex(a,o),vg.vertex(m,o),vg.vertex(n,o),vg.vertex(m,d),vg.vertex(r,d),vg.vertex(n,d),vg.vertex(r,u),vg.vertex(m,u),vg.vertex(a,u)])},t.primCreateCube=()=>{let s=1/Math.sqrt(3),e=[h(-s,-s,-s),h(-s,-s,s),h(s,-s,-s),h(s,-s,s),h(-s,s,-s),h(-s,s,s),h(s,s,-s),h(s,s,s)],r=[h(-1,0,0),h(0,0,1),h(1,0,0),h(0,0,-1),h(0,1,0),h(0,-1,0)],m={f0:{v:[0,1,5,4],n:0},f1:{v:[1,3,7,5],n:1},f2:{v:[3,2,6,7],n:2},f3:{v:[0,4,6,2],n:3},f4:{v:[4,5,7,6],n:4},f5:{v:[0,2,3,1],n:5}},a=[i(0,1),i(0,0),i(1,0),i(1,1)],n=[],l=[],o=0;for(let t in m){for(let i=0;i<m[t].v.length;i++)n.push(vg.vertex(e[m[t].v[i]],r[m[t].n],a[i]));for(let i=1;i<m[t].v.length-1;i++)l=l.concat([o+0,o+i,o+i+1]);o+=m[t].v.length}return t.primCreate(n,l)},t.primCreateIcosahedron=()=>{let i=Math.sqrt(5)/2,s=1/i,e=[];for(let t=0;t<360;t+=72){let i=t*Math.PI/180;e.push(h(s*Math.sin(i),-.5*s,s*Math.cos(i)))}for(let t=0;t<360;t+=72){let i=(t+36)*Math.PI/180;e.push(h(s*Math.sin(i),.5*s,s*Math.cos(i)))}let r=[];for(let t=0;t<5;t++){let i=e[t],s=e[5+t],h=e[(t+1)%5],m=e[(t+1)%5+5],a=T(i,h,s),n=T(s,h,m);r.push(vg.vertex(i,a)),r.push(vg.vertex(h,a)),r.push(vg.vertex(s,a)),r.push(vg.vertex(s,n)),r.push(vg.vertex(h,n)),r.push(vg.vertex(m,n))}let m=s*i,a=h(0,-m,0),n=h(0,m,0);for(let t=0;t<5;t++){let i=e[t],s=e[5+t],h=e[(t+1)%5],m=e[(t+1)%5+5],l=T(i,a,h),o=T(s,m,n);r.push(vg.vertex(i,l)),r.push(vg.vertex(a,l)),r.push(vg.vertex(h,l)),r.push(vg.vertex(s,o)),r.push(vg.vertex(m,o)),r.push(vg.vertex(n,o))}return t.primCreate(r)},t.primCreateOctahedron=()=>{let i=[h(-1,0,0),h(0,0,1),h(1,0,0),h(0,0,-1),h(0,1,0),h(0,-1,0)],s=[[0,1,4],[1,2,4],[2,3,4],[3,0,4],[0,5,1],[1,5,2],[2,5,3],[3,5,0]],e=[];for(let t=0;t<s.length;t++){let h=i[s[t][0]],r=i[s[t][1]],m=i[s[t][2]],a=T(h,r,m);e.push(vg.vertex(h,a)),e.push(vg.vertex(r,a)),e.push(vg.vertex(m,a))}return t.primCreate(e)},t.primCreateDodecahedron=()=>{let i=Math.sqrt(5)/2,s=1/i,e=[];for(let t=0;t<360;t+=72){let i=t*Math.PI/180;e.push(h(s*Math.sin(i),-.5*s,s*Math.cos(i)))}for(let t=0;t<360;t+=72){let i=(t+36)*Math.PI/180;e.push(h(s*Math.sin(i),.5*s,s*Math.cos(i)))}let r=[];for(let t=0;t<5;t++){let i=e[t],s=e[5+t],h=e[(t+1)%5],m=e[(t+1)%5+5];r.push(i.add(h).add(s).div(3)),r.push(s.add(h).add(m).div(3))}let m=[],a=[],n=s*i,l=h(0,-n,0),o=h(0,n,0);for(let t=0;t<5;t++){let i=e[t],s=e[5+t],h=e[(t+1)%5],r=e[(t+1)%5+5];a.unshift(i.add(l).add(h).div(3)),m.push(s.add(r).add(o).div(3))}let d=[],u=[],c=0;[m,a].forEach((t=>{let i=T(t[0],t[1],t[2]);t.forEach((t=>u.push(vg.vertex(t,i)))),d=d.concat([c+0,c+1,c+2,c+0,c+2,c+3,c+0,c+3,c+4]),c+=5}));for(let t=0;t<5;t++){let i=[r[(2*t+1)%10],r[(2*t+2)%10],r[(2*t+3)%10],m[(t+1)%5],m[t+0]],s=T(i[0],i[1],i[2]);i.forEach((t=>u.push(vg.vertex(t,s)))),d=d.concat([c+0,c+1,c+2,c+0,c+2,c+3,c+0,c+3,c+4]),c+=5}for(let t=0;t<5;t++){let i=[a[4-t+0],a[4-(t+1)%5],r[(2*t+2)%10],r[(2*t+1)%10],r[(2*t+0)%10]],s=T(i[0],i[1],i[2]);i.forEach((t=>u.push(vg.vertex(t,s)))),d=d.concat([c+0,c+1,c+2,c+0,c+2,c+3,c+0,c+3,c+4]),c+=5}return t.primCreate(u,d)}};class M{cam=n();timer=new P;frameData={camLoc:[1,2,3,4],camRight:[1,2,3,4],camUp:[1,2,3,4],camDir:[1,2,3,4],sizes:[1,2,3,4],time:[1,2,3,4],flags:[0,1,1,0]};primData={MatrWVP:m(),MatrW:m(),MatrInvWTrans:m()};timer=new P;constructor(t,i){"string"==typeof t&&(t=document.getElementById(t)),this.canvas=t;let s=t.getContext("webgl2");this.gl=s,this.frameBuf=u(this,"frameBuffer",this.frameData,1),this.primBuf=u(this,"primBuffer",this.primData,2),this.cam.setSize(s.canvas.width,s.canvas.height),this.primitives=[],this.shaders={default:x(this,"default")},this.addShader=t=>{if(!this.shaders.name)return this.shaders[t]=x(this,t)},s.clearColor(.3,.47,.8,1),s.enable(s.DEPTH_TEST),s.enable(s.BLEND),s.blendFunc(s.SRC_ALPHA,s.ONE_MINUS_SRC_ALPHA),z.addPrimitives(this),b.materialLibInit(this),i(this)}primCreate(...t){let i=z(this,...t);return this.primitives.push(i),i}renderLoop(t){const i=()=>{this.cam.setSize(this.gl.canvas.clientWidth,this.gl.canvas.clientHeight),this.gl.canvas.width=this.gl.canvas.clientWidth,this.gl.canvas.height=this.gl.canvas.clientHeight,this.gl.viewport(0,0,this.gl.canvas.width,this.gl.canvas.height),this.gl.clear(this.gl.COLOR_BUFFER_BIT|this.gl.DEPTH_BUFFER_BIT),this.timer.response(),this.frameData.camLoc=this.cam.loc.toArray().concat([0]),this.frameData.camRight=this.cam.right.toArray().concat([0]),this.frameData.camUp=this.cam.up.toArray().concat([0]),this.frameData.camDir=this.cam.dir.toArray().concat([0]),this.frameData.sizes=[this.cam.frameW,this.cam.frameH,this.cam.projSize,this.cam.projDist],this.frameData.time=[this.timer.localTime,this.timer.localDeltaTime,this.timer.globalTime,this.timer.globalDeltaTime],this.frameBuf.update(this.frameData),t&&t(this),window.requestAnimationFrame(i)};i()}}if(null==window.vg){window.vec2=i,window.vec3=h,window.mat4=m,window.camera=n,window.vg={},window.vg.vertex=function(...t){return new B(...t)},window.vg.render=function(...t){return new M(...t)};let t=0;window.vg.log=i=>{let s=document.getElementById("log");return s?(s.innerHTML+=`[${t}]: ${i}\n`,s.scrollTop=s.scrollHeight):console.log(i),t++},window.vg.logAdd=(t,i=-1)=>{if(-1==i)vg.log(t);else{let s=document.getElementById("log");if(s){let e,h=s.innerHTML,r=h.indexOf(`[${i}]: `);-1==r||-1==(e=h.indexOf("\n[",r))?(-1==r?h+=`[${i}]: ${t}\n`:h=h.slice(0,-1)+`${t}\n`,s.scrollTop=s.scrollHeight):h=h.slice(0,r)+h.slice(r,e)+t+h.slice(e),s.innerHTML=h}else console.log(t)}}}window.addEventListener("load",(()=>{vg.log("CGSG forever!!! main.js imported"),function(){let t=document.getElementById("myCan");const i=vg.render(t,(t=>{}));i.canvas.parentNode.querySelector(".pause").onclick=t=>{i.timer.isPause=!!t.target.checked};let s={Tetrahedron:i.primCreateTetrahedron(),Cube:i.primCreateCube(),Icosahedron:i.primCreateIcosahedron(),Octahedron:i.primCreateOctahedron(),Dodecahedron:i.primCreateDodecahedron()},e=document.getElementById("objSelect");for(let t in s)(h=document.createElement("option")).appendChild(document.createTextNode(t)),h.setAttribute("value",t),e.appendChild(h);e=document.getElementById("mtlSelect");for(let t in i.materialLib){var h;(h=document.createElement("option")).appendChild(document.createTextNode(t)),h.setAttribute("value",t),e.appendChild(h)}i.renderLoop((t=>{t.cam.set(vec3(3),vec3(0),vec3(0,1,0)),t.canvas.parentNode.querySelector(".fps").innerHTML=t.timer.FPS.toFixed(2);let i=s[document.getElementById("objSelect").value];i.setMtl(t.materialLib[document.getElementById("mtlSelect").value]),i.transform=mat4().rotate(90*t.timer.localTime,vec3(1,2,3)),i.draw()}))}()}))}();
